<script>
    $(document).ready(function() {
        var table = $('#swimmingTable').DataTable({
            retrieve: true,
            paging: false
        });

        var sheetID = '1DNeuIMq7WrUEu98xt8CV5K2UyW7kNqij9tcmtMEwEL0';
        var sheetURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

        function fetchData() {
            $.ajax({
                url: sheetURL,
                dataType: 'text',
                success: function(response) {
                    let jsonData = JSON.parse(response.substr(47).slice(0, -2));
                    let rows = jsonData.table.rows;
                    let data = [];
                    let teams = new Set();
                    let ageGroups = new Set();

                    rows.forEach(row => {
                        let rowData = row.c.map(cell => cell && cell.v ? cell.v.toString().trim() : '');
                        if (rowData.length >= 16) {
                            data.push(rowData);
                            if (rowData[3]) teams.add(rowData[3]);
                            if (rowData[0]) ageGroups.add(rowData[0]);
                        }
                    });

                    table.clear();
                    table.rows.add(data).draw();

                    $('#teamFilter').html('<option value="">All</option>' + Array.from(teams).map(team => `<option value="${team}">${team}</option>`).join(''));
                    $('#ageGroupFilter').html('<option value="">All</option>' + Array.from(ageGroups).map(ageGroup => `<option value="${ageGroup}">${ageGroup}</option>`).join(''));
                }
            });
        }

        function filterTable() {
            var team = $('#teamFilter').val().toLowerCase();
            var ageGroup = $('#ageGroupFilter').val().toLowerCase();
            var type = $('#typeFilter').val().toLowerCase();

            table.column(0).search(ageGroup, true, false);
            table.column(1).search(type, true, false);
            table.column(3).search(team, true, false);
            table.draw();
        }

        $('#teamFilter, #ageGroupFilter, #typeFilter').on('change', filterTable);

        fetchData();
    });
</script>
